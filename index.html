<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>like teardrops oranges hung</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>1lchrylime</h1>

  <div id="visitor-stats">
    <p id="visit-count">loading visit count...</p>
    <div id="visitor-log"></div>
  </div>

  <!-- Show visitor stats -->
  <script>
    console.log("fetching visitor stats...");

    fetch("https://sheetdb.io/api/v1/ovgpnrzj00t4b")
      .then(response => response.json())
      .then(data => {
        console.log("parsed visitor data:", data);
        const visits = data.length;
        document.getElementById("visit-count").textContent =
          `you are visitor number ${visits}`;

        const logContainer = document.getElementById("visitor-log");
        const rows = data
          .map(entry => {
            const date = new Date(entry.timestamp);
            const dateStr = date.toLocaleDateString("en-US", {
              year: "2-digit",
              month: "2-digit",
              day: "2-digit"
            }).replaceAll("/", ".");

            const timeStr = date.toLocaleTimeString("en-US", {
              hour12: false,
              hour: "2-digit",
              minute: "2-digit",
              second: "2-digit"
            });

            const city = entry.city || "";
            const country = entry.country || "";
            const location = `${city}, ${country}`.toLowerCase();

            return `${dateStr} ${timeStr} ${location}`;
          })
          .reverse(); // most recent first

        logContainer.innerHTML = rows.map(r => `<p>${r}</p>`).join("");
      })
      .catch(error => {
        console.error("failed to load visitor data:", error);
      });
  </script>

  <!-- Log new visitor -->
  <script>
    fetch("https://ipinfo.io/json?token=ffb97be19c9016")
      .then(response => response.json())
      .then(data => {
        const payload = {
          data: {
            timestamp: new Date().toISOString(),
            ip: data.ip,
            country: data.country,
            city: data.city
          }
        };

        fetch("https://sheetdb.io/api/v1/ovgpnrzj00t4b", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(json => console.log("sheetdb response:", json))
        .catch(err => console.error("sheetdb error:", err));
      })
      .catch(err => console.error("ipinfo error:", err));
  </script>
</body>
</html>
